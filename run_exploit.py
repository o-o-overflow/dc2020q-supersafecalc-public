#!/usr/bin/env python

import subprocess
import struct


with open("solution1", "rb") as fp:
    content = fp.read()

p = subprocess.Popen("python -u ./supersafecalc.pyc 1234567".split(), stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
firstrun, _ = p.communicate(content)
for i,l in enumerate(firstrun.split(b"\n")):
    if b"Result" in l:
        firstpart = struct.pack("<Q", int(firstrun.split(b"\n")[i+1]))


with open("solution2", "rb") as fp:
    content = fp.read()

p = subprocess.Popen("python -u ./supersafecalc.pyc 1234567".split(), stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
secondrun, _ = p.communicate(content)
for i,l in enumerate(secondrun.split(b"\n")):
    if b"Result" in l:
        secondpart = struct.pack("<Q", int(secondrun.split(b"\n")[i+1]))


flag = firstpart+secondpart
flag = flag[:flag.find(b"}")+1]

assert b"OOO{" in flag
assert b"}" in flag

print(b"FLAG: " + flag)

